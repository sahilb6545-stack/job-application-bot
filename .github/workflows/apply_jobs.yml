name: Job Application Bot
on:
  schedule:
    - cron: "0 */2 * * *"
  workflow_dispatch:
jobs:
  apply:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium
          playwright install-deps chromium
      - name: Run job application bot
        env:
          LINKEDIN_EMAIL: ${{ secrets.LINKEDIN_EMAIL }}
          LINKEDIN_PASSWORD: ${{ secrets.LINKEDIN_PASSWORD }}
          LINKEDIN_COOKIE: ${{ secrets.LINKEDIN_COOKIE }}
          INDEED_EMAIL: ${{ secrets.INDEED_EMAIL }}
          INDEED_PASSWORD: ${{ secrets.INDEED_PASSWORD }}
          SMTP_EMAIL: ${{ secrets.SMTP_EMAIL }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          NOTIFY_EMAIL: ${{ secrets.NOTIFY_EMAIL }}
          APPLICANT_PHONE: ${{ secrets.APPLICANT_PHONE }}
        run: python main.py --once
      - name: Commit application log
        run: |
          git config user.email "sahilbhatt3328@gmail.com"
          git config user.name "Job Bot"
          git add data/applications.csv || true
          git commit -m "log: update application records" || true
          git push || true
